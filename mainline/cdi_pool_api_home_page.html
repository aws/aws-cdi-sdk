<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<title>CDI SDK: CDI Pool API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="image_left.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CDI SDK
   </div>
   <div id="projectbrief">SDK for transporting chunks of data reliably and with low latency using a polled mode network driver.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">CDI Pool API</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="cdi_pool_api_intro_sec"></a>
Introduction</h1>
<p>CDI Pool provides a collection of generic functions for managing memory use. Using CDI Pool functions, users can pre-allocate a memory block sized to fit a given number of items of the user's data type, then reserve and free items from the pool as needed. Pools can be created and zeroed-out, and optionally the contents of each pool item can be initialized using a user-provided callback function. Finally, pools can be set up to grow automatically when they are not large enough to accommodate a new request, and can error out when a provided grow limit is reached.</p>
<p>Refer to <a class="el" href="cdi__pool__api_8h.html">cdi_pool_api.h</a> for API details.</p>
<h1><a class="anchor" id="cdi_pool_api_example_sec"></a>
Example</h1>
<p>As outlined in the API, several functions exist for creating pools. The following example demonstrates the instructions needed to generate a pool of transmit buffers from a pre-allocated buffer space. In this example, the pool function <a class="el" href="cdi__pool__api_8h.html#a46a59b23425dbb155984c6cd624f9c9c">CdiPoolCreateUsingExistingBuffer()</a> is used to allocate payload buffers within the adapter buffer that is reserved when the adapter is initialized.</p>
<p>Set defines and initialize variables. Use the CdiPoolHandle type to create a pool handle. </p><div class="fragment"><div class="line"><a class="code hl_struct" href="structCdiAdapterData.html">CdiAdapterData</a>* adapter_data_ptr;</div>
<div class="line"><a class="code hl_struct" href="structCdiPoolState.html">CdiPoolHandle</a> tx_buffer_pool_handle;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the number of total bytes to reserve from the adapter for payload storage.</span></div>
<div class="line">adapter_data_ptr-&gt;<a class="code hl_variable" href="structCdiAdapterData.html#a31b4864d0f3de2eb5034e43e3980e17e">tx_buffer_size_bytes</a> = TX_PAYLOAD_SIZE_BYTES * TX_NUM_PAYLOAD_BUFFERS;</div>
<div class="ttc" id="astructCdiAdapterData_html"><div class="ttname"><a href="structCdiAdapterData.html">CdiAdapterData</a></div><div class="ttdoc">Configuration data used by the CdiCoreNetworkAdapterInitialize() API function.</div><div class="ttdef"><b>Definition</b> cdi_core_api.h:480</div></div>
<div class="ttc" id="astructCdiAdapterData_html_a31b4864d0f3de2eb5034e43e3980e17e"><div class="ttname"><a href="structCdiAdapterData.html#a31b4864d0f3de2eb5034e43e3980e17e">CdiAdapterData::tx_buffer_size_bytes</a></div><div class="ttdeci">uint64_t tx_buffer_size_bytes</div><div class="ttdoc">The size in bytes of a memory region for holding payload data to transmit. If no transmit connections...</div><div class="ttdef"><b>Definition</b> cdi_core_api.h:490</div></div>
<div class="ttc" id="astructCdiPoolState_html"><div class="ttname"><a href="structCdiPoolState.html">CdiPoolState</a></div><div class="ttdoc">This structure represents the current state of a memory pool.</div><div class="ttdef"><b>Definition</b> pool.c:46</div></div>
</div><!-- fragment --><p>Initialize the adapter interface, and then use the returned ret_tx_buffer_ptr buffer pointer to create a pool of payload buffers which the application's transmit code can pull from later. The pool create function will return the actual number of bytes needed in buffer_bytes_size_needed_ptr. </p><div class="fragment"><div class="line"><a class="code hl_function" href="cdi__core__api_8h.html#af288fb42f760aa7a5ebbf689d8b73029">CdiCoreNetworkAdapterInitialize</a>(adapter_data_ptr, &amp;adapter_handle);</div>
<div class="line"><a class="code hl_function" href="cdi__pool__api_8h.html#a46a59b23425dbb155984c6cd624f9c9c">CdiPoolCreateUsingExistingBuffer</a>(<span class="stringliteral">&quot;Tx Buffer Pool&quot;</span>, TX_NUM_PAYLOAD_BUFFERS, TX_PAYLOAD_SIZE_BYTES,</div>
<div class="line">                                 <span class="keyword">false</span>, adapter_data_ptr-&gt;<a class="code hl_variable" href="structCdiAdapterData.html#a31d87a8145b5a71be6b2aa443bab0927">ret_tx_buffer_ptr</a>,</div>
<div class="line">                                 adapter_data_ptr-&gt;<a class="code hl_variable" href="structCdiAdapterData.html#a31b4864d0f3de2eb5034e43e3980e17e">tx_buffer_size_bytes</a>, buffer_bytes_size_needed_ptr,</div>
<div class="line">                                 &amp;tx_buffer_pool_handle);</div>
<div class="ttc" id="acdi__core__api_8h_html_af288fb42f760aa7a5ebbf689d8b73029"><div class="ttname"><a href="cdi__core__api_8h.html#af288fb42f760aa7a5ebbf689d8b73029">CdiCoreNetworkAdapterInitialize</a></div><div class="ttdeci">CDI_INTERFACE CdiReturnStatus CdiCoreNetworkAdapterInitialize(CdiAdapterData *adapter_data_ptr, CdiAdapterHandle *ret_handle_ptr)</div><div class="ttdef"><b>Definition</b> cdi_core_api.c:55</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_a46a59b23425dbb155984c6cd624f9c9c"><div class="ttname"><a href="cdi__pool__api_8h.html#a46a59b23425dbb155984c6cd624f9c9c">CdiPoolCreateUsingExistingBuffer</a></div><div class="ttdeci">CDI_INTERFACE bool CdiPoolCreateUsingExistingBuffer(const char *name_str, uint32_t item_count, uint32_t item_byte_size, bool thread_safe, void *buffer_ptr, uint32_t buffer_byte_size, uint32_t *buffer_byte_size_needed_ptr, CdiPoolHandle *ret_handle_ptr)</div><div class="ttdef"><b>Definition</b> pool.c:306</div></div>
<div class="ttc" id="astructCdiAdapterData_html_a31d87a8145b5a71be6b2aa443bab0927"><div class="ttname"><a href="structCdiAdapterData.html#a31d87a8145b5a71be6b2aa443bab0927">CdiAdapterData::ret_tx_buffer_ptr</a></div><div class="ttdeci">void * ret_tx_buffer_ptr</div><div class="ttdoc">Returned pointer to start of the allocated transmit buffer. Size is specified using tx_buffer_size_kb...</div><div class="ttdef"><b>Definition</b> cdi_core_api.h:494</div></div>
</div><!-- fragment --><p>Whenever a payload is to be sent, get a payload buffer from the pool. If the pool get fails, use pool functions to get information about the pool to use in a log message. </p><div class="fragment"><div class="line">uint32_t* new_tx_buffer_ptr;</div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_function" href="cdi__pool__api_8h.html#a8b816b43bad44e6d50682e4292598fec">CdiPoolGet</a>(tx_buffer_pool_handle, (<span class="keywordtype">void</span>**)&amp;new_tx_buffer_ptr)) {</div>
<div class="line">    <a class="code hl_define" href="cdi__logger__api_8h.html#aa7245716641ae31c7f88511931fd3a08">CDI_LOG_THREAD</a>(<a class="code hl_enumvalue" href="cdi__log__enums_8h.html#a419726836ec976c1dfbd9293d5f64705a959df2659726a9ade66bf741c5b53da5">kLogError</a>, <span class="stringliteral">&quot;Unable to get a buffer of [%d] bytes from pool[%s]. There are [%d] items left.&quot;</span>,</div>
<div class="line">                    <a class="code hl_function" href="cdi__pool__api_8h.html#a4e4fa325ecde2d3a3c93cf8d69a9b8b8">CdiPoolGetItemSize</a>(tx_buffer_pool_handle, <a class="code hl_function" href="cdi__pool__api_8h.html#aa688f3f18b98c2e51f3d149801b097aa">CdiPoolGetName</a>(tx_buffer_pool_handle),</div>
<div class="line">                    <a class="code hl_function" href="cdi__pool__api_8h.html#a32c24a5c3294a756953488f54ac19796">CdiPoolGetFreeItemCount</a>(tx_buffer_pool_handle));</div>
<div class="line">}</div>
<div class="ttc" id="acdi__log__enums_8h_html_a419726836ec976c1dfbd9293d5f64705a959df2659726a9ade66bf741c5b53da5"><div class="ttname"><a href="cdi__log__enums_8h.html#a419726836ec976c1dfbd9293d5f64705a959df2659726a9ade66bf741c5b53da5">kLogError</a></div><div class="ttdeci">@ kLogError</div><div class="ttdoc">Errors to the user.</div><div class="ttdef"><b>Definition</b> cdi_log_enums.h:53</div></div>
<div class="ttc" id="acdi__logger__api_8h_html_aa7245716641ae31c7f88511931fd3a08"><div class="ttname"><a href="cdi__logger__api_8h.html#aa7245716641ae31c7f88511931fd3a08">CDI_LOG_THREAD</a></div><div class="ttdeci">#define CDI_LOG_THREAD(log_level,...)</div><div class="ttdoc">Macro used to generate a formatted log line and send the message to the log associated with the calli...</div><div class="ttdef"><b>Definition</b> cdi_logger_api.h:76</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_a32c24a5c3294a756953488f54ac19796"><div class="ttname"><a href="cdi__pool__api_8h.html#a32c24a5c3294a756953488f54ac19796">CdiPoolGetFreeItemCount</a></div><div class="ttdeci">CDI_INTERFACE int CdiPoolGetFreeItemCount(CdiPoolHandle handle)</div><div class="ttdef"><b>Definition</b> pool.c:486</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_a4e4fa325ecde2d3a3c93cf8d69a9b8b8"><div class="ttname"><a href="cdi__pool__api_8h.html#a4e4fa325ecde2d3a3c93cf8d69a9b8b8">CdiPoolGetItemSize</a></div><div class="ttdeci">CDI_INTERFACE uint32_t CdiPoolGetItemSize(CdiPoolHandle handle)</div><div class="ttdef"><b>Definition</b> pool.c:479</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_a8b816b43bad44e6d50682e4292598fec"><div class="ttname"><a href="cdi__pool__api_8h.html#a8b816b43bad44e6d50682e4292598fec">CdiPoolGet</a></div><div class="ttdeci">CDI_INTERFACE bool CdiPoolGet(CdiPoolHandle handle, void **ret_item_ptr)</div><div class="ttdef"><b>Definition</b> pool.c:393</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_aa688f3f18b98c2e51f3d149801b097aa"><div class="ttname"><a href="cdi__pool__api_8h.html#aa688f3f18b98c2e51f3d149801b097aa">CdiPoolGetName</a></div><div class="ttdeci">CDI_INTERFACE const char * CdiPoolGetName(CdiPoolHandle handle)</div><div class="ttdef"><b>Definition</b> pool.c:472</div></div>
</div><!-- fragment --><p>In the case of transmit buffers, the buffers will be used by the SDK until the Tx Callback occurs. Pool items should be put back into the pool during the application's Tx Callback function. Buffers are to be returned to the pool using <a class="el" href="cdi__pool__api_8h.html#a6063a473aa0c47e3f37ab622b7355116">CdiPoolPut()</a>. </p><div class="fragment"><div class="line"><a class="code hl_function" href="cdi__pool__api_8h.html#a6063a473aa0c47e3f37ab622b7355116">CdiPoolPut</a>(tx_buffer_pool_handle, used_buffer_ptr);</div>
<div class="ttc" id="acdi__pool__api_8h_html_a6063a473aa0c47e3f37ab622b7355116"><div class="ttname"><a href="cdi__pool__api_8h.html#a6063a473aa0c47e3f37ab622b7355116">CdiPoolPut</a></div><div class="ttdeci">CDI_INTERFACE void CdiPoolPut(CdiPoolHandle handle, const void *item_ptr)</div><div class="ttdef"><b>Definition</b> pool.c:433</div></div>
</div><!-- fragment --><p>When the application is shutting down, destroy the pool. Under normal management and use of pool gets and puts, the call to <a class="el" href="cdi__pool__api_8h.html#a44c4ccf104be69a4e994a2a352a2f9d4">CdiPoolPutAll()</a> is unnecessary, and would probably be masking a coding error, but it can be used as a safeguard if desired. </p><div class="fragment"><div class="line"><a class="code hl_function" href="cdi__pool__api_8h.html#a44c4ccf104be69a4e994a2a352a2f9d4">CdiPoolPutAll</a>(tx_buffer_pool_handle);</div>
<div class="line"><a class="code hl_function" href="cdi__pool__api_8h.html#acffd1629a77f6f084f07418371402036">CdiPoolDestroy</a>(tx_buffer_pool_handle);</div>
<div class="ttc" id="acdi__pool__api_8h_html_a44c4ccf104be69a4e994a2a352a2f9d4"><div class="ttname"><a href="cdi__pool__api_8h.html#a44c4ccf104be69a4e994a2a352a2f9d4">CdiPoolPutAll</a></div><div class="ttdeci">CDI_INTERFACE void CdiPoolPutAll(CdiPoolHandle handle)</div><div class="ttdef"><b>Definition</b> pool.c:456</div></div>
<div class="ttc" id="acdi__pool__api_8h_html_acffd1629a77f6f084f07418371402036"><div class="ttname"><a href="cdi__pool__api_8h.html#acffd1629a77f6f084f07418371402036">CdiPoolDestroy</a></div><div class="ttdeci">CDI_INTERFACE void CdiPoolDestroy(CdiPoolHandle handle)</div><div class="ttdef"><b>Definition</b> pool.c:342</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
	<div>Copyright Amazon.com Inc. or its affiliates. All Rights Reserved.</div>
</small></address>
</body>
</html>
